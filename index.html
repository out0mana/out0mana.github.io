<html>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script>
        var currentSlide = 1;
        var slideData = {};
        var gotData = false;
        function render(slide) {
            console.log(slide);
            currentSlide = slide;
            d3.select('div').html = "";
            var width = 500;
            var height = 500;
            var margin = 50;
            var svg = d3.select('div').append('svg').attr('width', width).attr('height', height);
            var x = d3.scaleTime().domain([new Date(2020,1,1), new Date()]).range([0, width - 2 * margin]);
            var y = d3.scaleLinear().domain([14102,0]).range([0, height - 2 * margin]);
            var colors = d3.scaleLinear().domain([0,237]).range(['green','red']);
            if (slide == 1) {
                var data = slideData.ESP.data;
            } else if(slide == 2) {
                var data = slideData.USA.data;
            } else if(slide == 3) {
                var data = slideData.KOR.data;
            }

            svg.append('g').attr('transform', `translate(${margin},${margin})`)
                    .selectAll('circle').data(data).enter().append('circle')
                    .attr('cx', (d,i)=>{return x(new Date(d.date));})
                    .attr('cy', (d,i)=>{return y(d.total_cases_per_million)}) //max 14102
                    .attr('r', (d,i)=>{return 1 + d.new_cases_per_million / 40}); //max 237
        }
        function next() {
            currentSlide += 1;
            if(currentSlide > 3) currentSlide = 1;
            render(currentSlide);
        }
        async function getData() {
            console.log('getData');
            var data = await d3.json('https://out0mana.github.io/owid-covid-data.json');
            gotData = true;
            console.log(data);
            slideData.ESP = data.ESP; //spain
            slideData.USA = data.USA; //usa
            slideData.KOR = data.KOR; //korea
            render(1);
            
        }
    </script>
    <head>
        <h2>Difference in COVID-19 Responses in different countries.</h2>
        <button onclick="render(1)">1</button>
        <button onclick="render(2)">2</button>
        <button onclick="render(3)">3</button>
        <button onclick="next()">Next</button>
        <br>
    </head>
    <body onload="getData()">
        <div></div>
    </body>
</html>